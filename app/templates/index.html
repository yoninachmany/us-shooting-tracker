
<!-- This demo shows how to create interactions when clicking on list items and symbols. -->
<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8' />
  <title>Gun Violence Database Map</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.css' rel='stylesheet' />
  <style>
  body {
    color: #404040;
    font: 400 15px/22px 'Source Sans Pro', 'Helvetica Neue', Sans-serif;
    margin: 0;
    padding: 0;
    -webkit-font-smoothing: antialiased;
  }

  * {
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
  }

  .sidebar {
    position: absolute;
    width: 33.3333%;
    height: 100%;
    top: 0;
    left: 0;
    overflow: hidden;
    border-right: 1px solid rgba(0, 0, 0, 0.25);
  }

  .pad2 {
    padding: 20px;
  }

  .map {
    position: absolute;
    left: 33.3333%;
    width: 66.6666%;
    top: 0;
    bottom: 0;
  }

  h1 {
    font-size: 22px;
    margin: 0;
    font-weight: 400;
    line-height: 20px;
    padding: 20px 2px;
  }

  a {
    color: #404040;
    text-decoration: none;
  }

  a:hover {
    color: #101010;
  }

  .heading {
    background: #fff;
    border-bottom: 1px solid #eee;
    min-height: 60px;
    line-height: 60px;
    padding: 0 10px;
  }

  .listings {
    height: 100%;
    overflow: auto;
    padding-bottom: 60px;
  }

  .listings .item {
    display: block;
    border-bottom: 1px solid #eee;
    padding: 10px;
    text-decoration: none;
  }

  .listings .item:last-child {
    border-bottom: none;
  }

  .listings .item .title {
    display: block;
    color: #00853e;
    font-weight: 700;
  }

  .listings .item .title small {
    font-weight: 400;
  }

  .listings .item.active .title,
  .listings .item .title:hover {
    color: #8cc63f;
  }

  .listings .item.active {
    background-color: #f8f8f8;
  }

  ::-webkit-scrollbar {
    width: 3px;
    height: 3px;
    border-left: 0;
    background: rgba(0, 0, 0, 0.1);
  }

  ::-webkit-scrollbar-track {
    background: none;
  }

  ::-webkit-scrollbar-thumb {
    background: #00853e;
    border-radius: 0;
  }
  /* Marker tweaks */

  .mapboxgl-popup-close-button {
    display: none;
  }

  .mapboxgl-popup-content {
    font: 400 15px/22px 'Source Sans Pro', 'Helvetica Neue', Sans-serif;
    padding: 0;
    width: 180px;
  }

  .mapboxgl-popup-content-wrapper {
    padding: 1%;
  }

  .mapboxgl-popup-content h3 {
    background: #91c949;
    color: #fff;
    margin: 0;
    display: block;
    padding: 10px;
    border-radius: 3px 3px 0 0;
    font-weight: 700;
    margin-top: -15px;
  }

  .mapboxgl-popup-content h4 {
    margin: 0;
    display: block;
    padding: 10px;
    font-weight: 400;
    margin: 0;
  }

  .mapboxgl-popup-content div {
    padding: 10px;
  }

  .mapboxgl-container .leaflet-marker-icon {
    cursor: pointer;
  }

  .mapboxgl-popup-anchor-top > .mapboxgl-popup-content {
          margin-top: 15px;
        }

  .mapboxgl-popup-anchor-top > .mapboxgl-popup-tip {
    border-bottom-color: #91c949;
  }

.session {
  margin-bottom: 20px;
  padding: 10px;
}

.row {
  height: 12px;
  width: 100%;
}

.colors {
  background: linear-gradient(to right, #2dc4b2, #3bb3c3, #669ec4, #8b88b6, #a2719b, #aa5e79);
  margin-bottom: 5px;
}

.label {
  width: 15%;
  display: inline-block;
  text-align: center;
}


  </style>
</head>

<body>
  <div class='sidebar'>
    <div class='heading'>
        <h1><a href="http://gun-violence.org/">Gun Violence Database</a> map</h1>
    </div>
    <div id='listings' class='listings'>
        <div class='session'>
          <h3>Casualty</h3>
          <div class='row colors'>
          </div>
          <div class='row labels'>
            <div class='label'>0</div>
            <div class='label'>1</div>
            <div class='label'>2</div>
            <div class='label'>3</div>
            <div class='label'>4</div>
            <div class='label'>5+</div>
          </div>
        </div>
        <div class='session' id='sliderbar'>
          <h3>Hour: <label id='active-hour'>12PM</label></h3>
          <input id='slider' class='row' type='range' min='0' max='23' step='1' value='12' />
        </div>
    </div>
  </div>

  <div id='map' class='map'> </div>

  <script>
  // This will let you use the .remove() function later on
  if (!('remove' in Element.prototype)) {
    Element.prototype.remove = function() {
      if (this.parentNode) {
        this.parentNode.removeChild(this);
      }
    };
  }

  mapboxgl.accessToken = 'pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2lqbmpqazdlMDBsdnRva284cWd3bm11byJ9.V6Hg2oYJwMAxeoR9GEzkAA';

 // This adds the map to your page
  var map = new mapboxgl.Map({
    // container id specified in the HTML
    container: 'map',
    // style URL
    style: 'mapbox://styles/mapbox/light-v9',
    // initial position in [long, lat] format
    center: [-97.0000, 38.0000],
    // initial zoom
    zoom: 3.5
  });

  // Add zoom and rotation controls to the map.
  map.addControl(new mapboxgl.NavigationControl());

  var stores = {
    "type": "FeatureCollection",
    "features": [{
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-90.7454215, 29.578277]
      },
      "properties": {
      "articleTitle": "Police Shoot, Kill Theft Suspect in Houma - FOX29 Lake Charles",
      "articleUrl": "http://www.watchfox29.com/story/29662135/police-shoot-kill-theft-suspect-in-houma",
      "circumstances":{"number-of-shots-fired":{"endIndex":-1,"startIndex":-1,"value":""},"type-of-gun":{"endIndex":-1,"startIndex":-1,"value":""}},"date-and-time":{"city":{"endIndex":373,"startIndex":368,"value":"Houma"},"clock-time":{"endIndex":-1,"startIndex":-1,"value":""},"date":"","details":{"endIndex":576,"startIndex":536,"value":"Officers open fired, killing the suspect"},"state":"Louisiana","time-day":{"endIndex":173,"startIndex":159,"value":"Monday evening"}},"radio1":{"The firearm was used during another crime.":"Not mentioned","The firearm was used in self defense.":"Yes","The incident was a case of domestic violence.":"No","The shooter and the victim knew each other.":"No"},"radio2":{"Alcohol was involved.":"Not mentioned","Drugs (other than alcohol) were involved.":"Not mentioned","The shooting was a suicide or suicide attempt.":"No","The shooting was self-directed.":"No"},"radio3":{"The firearm was owned by the victim/victims family.":"No","The firearm was stolen.":"Not mentioned","The shooting was by a police officer.":"Yes","The shooting was directed at a police officer.":"No","The shooting was unintentional.":"No"},"shooter-section":[{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"","name":{"endIndex":30,"startIndex":0,"value":"Eight law enforcement officers"},"race":{"endIndex":-1,"startIndex":-1,"value":""}}],"victim-section":[{"age":{"endIndex":99,"startIndex":151,"value":"45-year-old"},"gender":"Male","name":{"endIndex":255,"startIndex":243,"value":"Jean Falgout"},"race":{"endIndex":-1,"startIndex":-1,"value":""},"victim-was":["killed"]}]}

    }, {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-81.9023382, 26.6186168]
      },
      "properties": {
      "articleTitle": "12-year-old shot three times, suspect on the loose | WINK NEWS",
      "articleUrl": "http://www.winknews.com/2015/08/02/12-year-old-shot-three-times-suspect-on-the-loose/",
      "circumstances":{"number-of-shots-fired":{"endIndex":493,"startIndex":477,"value":"shot three times"},"type-of-gun":{"endIndex":-1,"startIndex":-1,"value":""}},"date-and-time":{"city":{"endIndex":1089,"startIndex":1079,"value":"Fort Myers"},"clock-time":{"endIndex":-1,"startIndex":-1,"value":""},"date":"","details":{"endIndex":-1,"startIndex":-1,"value":""},"state":"Dunbar","time-day":{"endIndex":226,"startIndex":212,"value":"Saturday night"}},"radio1":{"The firearm was used during another crime.":"No","The firearm was used in self defense.":"No","The incident was a case of domestic violence.":"Yes","The shooter and the victim knew each other.":"No"},"radio2":{"Alcohol was involved.":"No","Drugs (other than alcohol) were involved.":"No","The shooting was a suicide or suicide attempt.":"No","The shooting was self-directed.":"No"},"radio3":{"The firearm was owned by the victim/victims family.":"No","The firearm was stolen.":"No","The shooting was by a police officer.":"No","The shooting was directed at a police officer.":"No","The shooting was unintentional.":"No"},"shooter-section":[{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"Female","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""}}],"victim-section":[{"age":{"endIndex":32,"startIndex":21,"value":"12-year-old"},"gender":"Female","name":{"endIndex":113,"startIndex":101,"value":"Luxury Vance"},"race":{"endIndex":-1,"startIndex":-1,"value":""},"victim-was":["injured","hospitalize"]}]}
    }, {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-90.2509738, 35.1288636]
      },
      "properties": {
      "articleTitle": "MPD Officer killed in the line of duty identified | WREG.com",
      "articleUrl": "http://wreg.com/2015/08/02/mpd-officer-killed-in-the-line-of-duty-identified/",
      "circumstances":{"number-of-shots-fired":{"endIndex":-1,"startIndex":-1,"value":""},"type-of-gun":{"endIndex":-1,"startIndex":-1,"value":""}},"date-and-time":{"city":{"endIndex":7,"startIndex":0,"value":"MEMPHIS"},"clock-time":{"endIndex":226,"startIndex":218,"value":"9:15 p.m"},"date":"","details":{"endIndex":209,"startIndex":117,"value":"According to MPD, Sean Bolton, 33, was conducting a traffic stop when he was fatally wounded"},"state":"Tenn","time-day":{"endIndex":-1,"startIndex":-1,"value":""}},"radio1":{"The firearm was used during another crime.":"Not mentioned","The firearm was used in self defense.":"Not mentioned","The incident was a case of domestic violence.":"No","The shooter and the victim knew each other.":"No"},"radio2":{"Alcohol was involved.":"Not mentioned","Drugs (other than alcohol) were involved.":"Not mentioned","The shooting was a suicide or suicide attempt.":"No","The shooting was self-directed.":"No"},"radio3":{"The firearm was owned by the victim/victims family.":"No","The firearm was stolen.":"Not mentioned","The shooting was by a police officer.":"No","The shooting was directed at a police officer.":"Yes","The shooting was unintentional.":"No"},"shooter-section":[{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""}}],"victim-section":[{"age":{"endIndex":151,"startIndex":148,"value":"33,"},"gender":"Male","name":{"endIndex":146,"startIndex":135,"value":"Sean Bolton"},"race":{"endIndex":-1,"startIndex":-1,"value":""},"victim-was":["killed"]}]}
    }, {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-77.5633014, 37.5246403]
      },
      "properties": {
      "articleTitle": "Person on bike shot in the Fan - NBC12 - WWBT - Richmond, VA News On Your Side",
      "articleUrl": "http://www.nbc12.com/story/29692846/",
      "circumstances":{"number-of-shots-fired":{"endIndex":-1,"startIndex":-1,"value":""},"type-of-gun":{"endIndex":-1,"startIndex":-1,"value":""}},"date-and-time":{"city":{"endIndex":8,"startIndex":0,"value":"Richmond"},"clock-time":{"endIndex":108,"startIndex":92,"value":"around 3:15 a.m."},"date":"","details":{"endIndex":362,"startIndex":250,"value":" The victim says a vehicle ran up on him and opened fire. Police do not have\u00a0a suspect description at this time."},"state":"","time-day":{"endIndex":-1,"startIndex":-1,"value":""}},"radio1":{"The firearm was used during another crime.":"Not mentioned","The firearm was used in self defense.":"No","The incident was a case of domestic violence.":"No","The shooter and the victim knew each other.":"No"},"radio2":{"Alcohol was involved.":"Not mentioned","Drugs (other than alcohol) were involved.":"Not mentioned","The shooting was a suicide or suicide attempt.":"No","The shooting was self-directed.":"No"},"radio3":{"The firearm was owned by the victim/victims family.":"No","The firearm was stolen.":"Not mentioned","The shooting was by a police officer.":"No","The shooting was directed at a police officer.":"No","The shooting was unintentional.":"Not mentioned"},"shooter-section":[{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""}}],"victim-section":[{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"Male","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""},"victim-was":["hospitalize"]}]}
    }, {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-85.8168547, 38.1887218]
      },
      "properties": {
      "articleTitle": "Person shot overnight in Shawnee neighborhood - wave3.com-Louisville News, Weather & Sports",
      "articleUrl": "http://www.wave3.com/story/29692673/person-shot-overnight-on-broadway",
      "circumstances":{"number-of-shots-fired":{"endIndex":-1,"startIndex":-1,"value":""},"type-of-gun":{"endIndex":-1,"startIndex":-1,"value":""}},"date-and-time":{"city":{"endIndex":10,"startIndex":0,"value":"LOUISVILLE"},"clock-time":{"endIndex":-1,"startIndex":-1,"value":""},"date":"","details":{"endIndex":76,"startIndex":56,"value":"Shawnee neighborhood"},"state":"KY","time-day":{"endIndex":-1,"startIndex":-1,"value":""}},"radio1":{"The firearm was used during another crime.":"Yes","The firearm was used in self defense.":"Not mentioned","The incident was a case of domestic violence.":"Not mentioned","The shooter and the victim knew each other.":"Not mentioned"},"radio2":{"Alcohol was involved.":"Not mentioned","Drugs (other than alcohol) were involved.":"Not mentioned","The shooting was a suicide or suicide attempt.":"Not mentioned","The shooting was self-directed.":"Not mentioned"},"radio3":{"The firearm was owned by the victim/victims family.":"Not mentioned","The firearm was stolen.":"Not mentioned","The shooting was by a police officer.":"Not mentioned","The shooting was directed at a police officer.":"Not mentioned","The shooting was unintentional.":"Not mentioned"},"shooter-section":[{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""}}],"victim-section":[{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""},"victim-was":[]}]}
    }, {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-90.2509738, 35.1288636]
      },
      "properties": {
      "articleTitle": "Memphis Police officer shot, killed during traffic stop - FOX 8 WVUE New Orleans News, Weather, Sports, Social",
      "articleUrl": "http://www.fox8live.com/story/29688626/.continueReading.more",
      "circumstances":{"number-of-shots-fired":{"endIndex":-1,"startIndex":-1,"value":""},"type-of-gun":{"endIndex":-1,"startIndex":-1,"value":""}},"date-and-time":{"city":{"endIndex":9,"startIndex":2,"value":"Memphis"},"clock-time":{"endIndex":-1,"startIndex":-1,"value":""},"date":"","details":{"endIndex":121,"startIndex":88,"value":"near Cottonwood and Perkins Roads"},"state":"","time-day":{"endIndex":136,"startIndex":122,"value":"Saturday night"}},"radio1":{"The firearm was used during another crime.":"Not mentioned","The firearm was used in self defense.":"No","The incident was a case of domestic violence.":"No","The shooter and the victim knew each other.":"No"},"radio2":{"Alcohol was involved.":"Not mentioned","Drugs (other than alcohol) were involved.":"Not mentioned","The shooting was a suicide or suicide attempt.":"No","The shooting was self-directed.":"No"},"radio3":{"The firearm was owned by the victim/victims family.":"No","The firearm was stolen.":"Not mentioned","The shooting was by a police officer.":"No","The shooting was directed at a police officer.":"Yes","The shooting was unintentional.":"No"},"shooter-section":[{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""}}],"victim-section":[{"age":{"endIndex":192,"startIndex":181,"value":"33-year-old"},"gender":"Male","name":{"endIndex":204,"startIndex":193,"value":"Sean Bolton"},"race":{"endIndex":-1,"startIndex":-1,"value":""},"victim-was":["killed","hospitalize"]}]}
    }, {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-89.8885108, 44.2925062]
      },
      "properties": {
      "articleTitle": "Officials: 2 flown to hospital after Wood County crash - WAOW - Newsline 9, Wausau News, Weather, Sports",
      "articleUrl": "http://www.waow.com/story/29689839/2015/08/02/officials-2-flown-to-hospital-after-wood-county-crash",
      "circumstances":{"number-of-shots-fired":{"endIndex":-1,"startIndex":-1,"value":""},"type-of-gun":{"endIndex":-1,"startIndex":-1,"value":""}},"date-and-time":{"city":{"endIndex":150,"startIndex":142,"value":"Saratoga"},"clock-time":{"endIndex":12,"startIndex":7,"value":"6 a.m"},"date":"","details":{"endIndex":236,"startIndex":176,"value":"ruck was found in a ditch after it rolled over and hit trees"},"state":"","time-day":{"endIndex":23,"startIndex":17,"value":"Sunday"}},"radio1":{"The firearm was used during another crime.":"No","The firearm was used in self defense.":"No","The incident was a case of domestic violence.":"No","The shooter and the victim knew each other.":"No"},"radio2":{"Alcohol was involved.":"Not mentioned","Drugs (other than alcohol) were involved.":"Not mentioned","The shooting was a suicide or suicide attempt.":"No","The shooting was self-directed.":"No"},"radio3":{"The firearm was owned by the victim/victims family.":"No","The firearm was stolen.":"No","The shooting was by a police officer.":"No","The shooting was directed at a police officer.":"No","The shooting was unintentional.":"No"},"shooter-section":[{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""}}],"victim-section":[{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""},"victim-was":["injured","hospitalize"]}]}
    }, {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-88.692303, 33.600422]
      },
      "properties": {
      "articleUrl": "http://www.dailytimesleader.com/tags/crime",
      "articleTitle": "CRIME | The Daily Times Leader",
      "circumstances":{"number-of-shots-fired":{"endIndex":-1,"startIndex":-1,"value":""},"type-of-gun":{"endIndex":-1,"startIndex":-1,"value":""}},"date-and-time":{"city":{"endIndex":141,"startIndex":131,"value":"West Point"},"clock-time":{"endIndex":-1,"startIndex":-1,"value":""},"date":"","details":{"endIndex":68,"startIndex":53,"value":"alleged robbery"},"state":"MS","time-day":{"endIndex":90,"startIndex":74,"value":"Monday afternoon "}},"radio1":{"The firearm was used during another crime.":"Not mentioned","The firearm was used in self defense.":"Not mentioned","The incident was a case of domestic violence.":"No","The shooter and the victim knew each other.":"Not mentioned"},"radio2":{"Alcohol was involved.":"Not mentioned","Drugs (other than alcohol) were involved.":"Not mentioned","The shooting was a suicide or suicide attempt.":"No","The shooting was self-directed.":"No"},"radio3":{"The firearm was owned by the victim/victims family.":"Not mentioned","The firearm was stolen.":"Not mentioned","The shooting was by a police officer.":"Not mentioned","The shooting was directed at a police officer.":"Not mentioned","The shooting was unintentional.":"No"},"shooter-section":[{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""}}],"victim-section":[{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""},"victim-was":[]}]}
    }, {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [47.1830462,-122.3212979]
      },
      "properties": {
      "articleTitle": "Sheriff's office: Man kills girlfriend, self near Puyallup - Spokane, North Idaho News & Weather KHQ.com",
      "articleUrl": "http://www.khq.com/story/29696543/sheriffs-office-man-kills-girlfriend-self-near-puyallup",
      "circumstances":{"number-of-shots-fired":{"endIndex":-1,"startIndex":-1,"value":""},"type-of-gun":{"endIndex":-1,"startIndex":-1,"value":""}},"date-and-time":{"city":{"endIndex":8,"startIndex":0,"value":"PUYALLUP"},"clock-time":{"endIndex":-1,"startIndex":-1,"value":""},"date":"","details":{"endIndex":172,"startIndex":63,"value":"a 31-year-old man shot and killed his 34-year-old girlfriend and then himself inside her home near Puyallup. "},"state":"Wash.","time-day":{"endIndex":541,"startIndex":511,"value":"late Saturday or early Sunday,"}},"radio1":{"The firearm was used during another crime.":"Not mentioned","The firearm was used in self defense.":"No","The incident was a case of domestic violence.":"Yes","The shooter and the victim knew each other.":"Yes"},"radio2":{"Alcohol was involved.":"Not mentioned","Drugs (other than alcohol) were involved.":"Not mentioned","The shooting was a suicide or suicide attempt.":"Yes","The shooting was self-directed.":"Yes"},"radio3":{"The firearm was owned by the victim/victims family.":"Not mentioned","The firearm was stolen.":"Not mentioned","The shooting was by a police officer.":"No","The shooting was directed at a police officer.":"No","The shooting was unintentional.":"No"},"shooter-section":[{"age":{"endIndex":76,"startIndex":65,"value":"31-year-old"},"gender":"Male","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""}}],"victim-section":[{"age":{"endIndex":113,"startIndex":101,"value":"34-year-old "},"gender":"Female","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""},"victim-was":["killed"]},{"age":{"endIndex":76,"startIndex":65,"value":"31-year-old"},"gender":"Male","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""},"victim-was":["killed"]}]}
    }, {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-90.2509738, 35.1288636]
      },
      "properties": {
      "articleTitle": "Home | LOCALMEMPHIS",
      "articleUrl": "http://www.localmemphis.com/",
      "circumstances":{"number-of-shots-fired":{"endIndex":-1,"startIndex":-1,"value":""},"type-of-gun":{"endIndex":-1,"startIndex":-1,"value":""}},"date-and-time":{"city":{"endIndex":80,"startIndex":73,"value":"Memphis"},"clock-time":{"endIndex":-1,"startIndex":-1,"value":""},"date":"","details":{"endIndex":139,"startIndex":80,"value":"Officers have a person-of-interest in custody from last night's shooting Memphis Police are on the scene of apartments in Southeast Memphis"},"state":"","time-day":{"endIndex":-1,"startIndex":-1,"value":""}},"radio1":{"The firearm was used during another crime.":"Not mentioned","The firearm was used in self defense.":"Not mentioned","The incident was a case of domestic violence.":"Not mentioned","The shooter and the victim knew each other.":"Not mentioned"},"radio2":{"Alcohol was involved.":"Not mentioned","Drugs (other than alcohol) were involved.":"Not mentioned","The shooting was a suicide or suicide attempt.":"Not mentioned","The shooting was self-directed.":"Not mentioned"},"radio3":{"The firearm was owned by the victim/victims family.":"Not mentioned","The firearm was stolen.":"Not mentioned","The shooting was by a police officer.":"Not mentioned","The shooting was directed at a police officer.":"Not mentioned","The shooting was unintentional.":"Not mentioned"},"shooter-section":[{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""}}],"victim-section":[{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""},"victim-was":[]}]}
    }, {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-77.5633014, 37.5246403]
      },
      "properties": {
      "articleTitle": "Person on bike shot in the Fan - NBC12 - WWBT - Richmond, VA News On Your Side",
      "articleUrl": "http://www.nbc12.com/story/29692846/DCSext.contentprovider",
      "circumstances":{"number-of-shots-fired":{"endIndex":166,"startIndex":151,"value":"shot in the leg"},"type-of-gun":{"endIndex":-1,"startIndex":-1,"value":""}},"date-and-time":{"city":{"endIndex":8,"startIndex":0,"value":"Richmond"},"clock-time":{"endIndex":107,"startIndex":99,"value":"3:15 a.m"},"date":"","details":{"endIndex":307,"startIndex":136,"value":"The victim was shot in the leg while riding a bike. He was taken to VCU Medical Center and is expected to be okay. The victim says a vehicle ran up on him and opened fire."},"state":"","time-day":{"endIndex":-1,"startIndex":-1,"value":""}},"radio1":{"The firearm was used during another crime.":"Not mentioned","The firearm was used in self defense.":"No","The incident was a case of domestic violence.":"No","The shooter and the victim knew each other.":"No"},"radio2":{"Alcohol was involved.":"Not mentioned","Drugs (other than alcohol) were involved.":"Not mentioned","The shooting was a suicide or suicide attempt.":"No","The shooting was self-directed.":"No"},"radio3":{"The firearm was owned by the victim/victims family.":"No","The firearm was stolen.":"Not mentioned","The shooting was by a police officer.":"No","The shooting was directed at a police officer.":"No","The shooting was unintentional.":"No"},"shooter-section":[{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""}},{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""}}],"victim-section":[{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"Male","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""},"victim-was":["injured","hospitalize"]},{"age":{"endIndex":-1,"startIndex":-1,"value":""},"gender":"","name":{"endIndex":-1,"startIndex":-1,"value":""},"race":{"endIndex":-1,"startIndex":-1,"value":""},"victim-was":[]}]}
    }]
  };
  // This adds the data to the map
  map.on('load', function (e) {
    // Add the data to your map as a layer
    map.addLayer({
      "id": "locations",
      "type": "circle",
      // Add a GeoJSON source containing place coordinates and information.
      "source": {
        "type": "geojson",
        "data": stores
      },
      paint: {
        'circle-radius': [
          'interpolate',
          ['linear'],
          ['number', ['length', ['array', ['get', 'victim-section']]]],
          0, 4,
          5, 24
        ],
        'circle-color': [
          'interpolate',
          ['linear'],
          ['number', ['length', ['array', ['get', 'victim-section']]]],
          0, '#2DC4B2',
          1, '#3BB3C3',
          2, '#669EC4',
          3, '#8B88B6',
          4, '#A2719B',
          5, '#AA5E79'
        ],
        'circle-opacity': 0.8
      }
    });
    // Initialize the list
    buildLocationList(stores);
  });

  document.getElementById('slider').addEventListener('input', function(e) {
      var hour = parseInt(e.target.value);
      // update the map
      map.setFilter('collisions', ['==', ['number', ['get', 'Hour']], hour]);

      // converting 0-23 hour to AMPM format
      var ampm = hour >= 12 ? 'PM' : 'AM';
      var hour12 = hour % 12 ? hour % 12 : 12;

      // update text in the UI
      document.getElementById('active-hour').innerText = hour12 + ampm;
    });


  map.on('click', function(e) {
    var features = map.queryRenderedFeatures(e.point, {
      layers: ['locations']
    });

    if (features.length) {
      var clickedPoint = features[0];
      // 1. Fly to the point
      flyToStore(clickedPoint);

      // 2. Close all other popups and display popup for clicked store
      createPopUp(clickedPoint);

      // 3. Highlight listing in sidebar (and remove highlight for all other listings)
     var activeItem = document.getElementsByClassName('active');
      if (activeItem[0]) {
        activeItem[0].classList.remove('active');
      }

      var selectedFeature = clickedPoint.properties.address;

      for (var i = 0; i < stores.features.length; i++ ) {
        if (stores.features[i].properties.address === selectedFeature) {
            selectedFeatureIndex = i;
        }
      }

      var listing = document.getElementById('listing-' + selectedFeatureIndex);
      listing.classList.add('active');

    }
  });


  function flyToStore(currentFeature) {
    map.flyTo({
      center: currentFeature.geometry.coordinates,
      zoom: 5
    });
  }


  function createPopUp(currentFeature) {
    var popUps = document.getElementsByClassName('mapboxgl-popup');
    if (popUps[0]) popUps[0].remove();


    var popup = new mapboxgl.Popup({closeOnClick: false})
      .setLngLat(currentFeature.geometry.coordinates)
      .setHTML('<h3>' + currentFeature.properties['articleTitle'] + '</h3>' +
        '<h4>Date and time</h4>' +
        '<h4>Victim section</h4>' +
        '<h4>Shooter section</h4>' +
        '<h4>Circumstances</h4>'
        )
      .addTo(map);
  }


  function buildLocationList(data) {
    for (i = 0; i < data.features.length; i++) {
      // Create an array of all the stores and their properties
      var currentFeature = data.features[i];
      // Shorten data.feature.properties to just `prop` so we're not
      // writing this long form over and over again.
      var prop = currentFeature.properties;
      // Select the listing container in the HTML
      var listings = document.getElementById('listings');
      // Append a div with the class 'item' for each store
      var listing = listings.appendChild(document.createElement('div'));
      listing.className = 'item';
      listing.id = "listing-" + i;

      // Create a new link with the class 'title' for each store
      // and fill it with the store address
      var link = listing.appendChild(document.createElement('a'));
      link.href = '#';
      link.className = 'title';
      link.dataPosition = i;
      link.innerHTML = prop['articleTitle'];

      // Create a new div with the class 'details' for each store
      // and fill it with the city and phone number
      var details = listing.appendChild(document.createElement('div'));
      details.innerHTML = "<a href=" + prop['articleUrl'] + ">" + prop['articleUrl'] + "</a>";


      link.addEventListener('click', function(e) {
        // Update the currentFeature to the store associated with the clicked link
        var clickedListing = data.features[this.dataPosition];

        // 1. Fly to the point associated with the clicked link
        flyToStore(clickedListing);

        // 2. Close all other popups and display popup for clicked store
        createPopUp(clickedListing);

        // 3. Highlight listing in sidebar (and remove highlight for all other listings)
        var activeItem = document.getElementsByClassName('active');

        if (activeItem[0]) {
          activeItem[0].classList.remove('active');
        }
        this.parentNode.classList.add('active');

      });
    }
  }

  </script>
</body>

</html>

